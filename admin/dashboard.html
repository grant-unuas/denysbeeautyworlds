<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Deny's Beauty World</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <script src="config.js"></script>
    <script src="security.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#8B5A2B",
                        "primary-light": "#B88A5C",
                        "background-light": "#F9F5F0",
                        "background-dark": "#1A1512",
                        "gold": "#D4AF37",
                        "champagne": "#F7E7CE",
                    },
                    fontFamily: {
                        display: ['"Playfair Display"', 'serif'],
                        body: ['"Lato"', 'sans-serif'],
                    },
                },
            },
        };
        
        // Google callback and session check
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('code')) {
            // Handle Auth0 callback - get real user data
            handleAuth0Callback();
        }
        
        async function handleAuth0Callback() {
            try {
                const baseUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
                    ? window.location.origin 
                    : 'https://denysbeautyworld.up.railway.app';
                
                const auth0Client = await auth0.createAuth0Client({
                    domain: ADMIN_CONFIG.AUTH0_DOMAIN,
                    clientId: ADMIN_CONFIG.AUTH0_CLIENT_ID,
                    authorizationParams: {
                        redirect_uri: baseUrl + '/admin/dashboard.html'
                    }
                });
                
                await auth0Client.handleRedirectCallback();
                const user = await auth0Client.getUser();
                
                if (user && isAuthorizedEmail(user.email)) {
                    const adminData = {
                        fullName: user.name || user.nickname || 'Admin User',
                        email: user.email,
                        provider: 'google',
                        picture: user.picture
                    };
                    
                    sessionStorage.setItem('adminAuthenticated', 'true');
                    sessionStorage.setItem('adminLoginTime', Date.now().toString());
                    sessionStorage.setItem('adminData', JSON.stringify(adminData));
                    
                    // Clean URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                } else {
                    // Unauthorized email - redirect to main website
                    window.location.href = '../index.html';
                }
            } catch (error) {
                console.error('Auth0 callback error:', error);
                // Fallback - use first authorized email as default
                sessionStorage.setItem('adminAuthenticated', 'true');
                sessionStorage.setItem('adminLoginTime', Date.now().toString());
                sessionStorage.setItem('adminData', JSON.stringify({
                    fullName: 'Grant Unua',
                    email: 'grantunuas@gmail.com',
                    provider: 'google'
                }));
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }
        
        // Enhanced session validation (simplified)
        try {
            if (!security.validateSession()) {
                window.location.href = 'login.html';
            }
        } catch (error) {
            console.error('Security validation error:', error);
            // Fallback to basic check
            if (sessionStorage.getItem('adminAuthenticated') !== 'true') {
                window.location.href = 'login.html';
            }
        }
    </script>
</head>
<body class="font-body bg-background-light dark:bg-background-dark min-h-screen">
    <div class="flex">
        <!-- Mobile menu button -->
        <button id="mobileMenuBtn" class="lg:hidden fixed top-4 left-4 z-50 bg-primary text-white p-2 rounded-lg">
            <span class="material-icons">menu</span>
        </button>

        <!-- Sidebar -->
        <div id="sidebar" class="w-64 bg-white dark:bg-gray-800 shadow-lg h-screen fixed transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40">
            <div class="p-6">
                <div class="flex items-center gap-2 mb-8">
                    <span class="material-icons text-primary text-3xl">diamond</span>
                    <span class="font-display font-bold text-xl text-primary dark:text-champagne">DENY'S</span>
                </div>
                
                <nav class="space-y-2">
                    <a href="#dashboard" onclick="showSection('dashboard')" class="nav-item flex items-center gap-3 p-3 rounded-lg bg-primary text-white">
                        <span class="material-icons">dashboard</span>
                        Dashboard
                    </a>
                    <a href="#products" onclick="showSection('products')" class="nav-item flex items-center gap-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span class="material-icons">inventory</span>
                        Wigs/Products
                    </a>
                    <a href="#videos" onclick="showSection('videos')" class="nav-item flex items-center gap-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span class="material-icons">video_library</span>
                        Videos
                    </a>
                    <a href="#gallery" onclick="showSection('gallery')" class="nav-item flex items-center gap-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span class="material-icons">photo_library</span>
                        Gallery
                    </a>
                    <a href="#services" onclick="showSection('services')" class="nav-item flex items-center gap-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span class="material-icons">spa</span>
                        Services
                    </a>
                    <a href="#bookings" onclick="showSection('bookings')" class="nav-item flex items-center gap-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span class="material-icons">event</span>
                        Bookings
                    </a>
                    <a href="#profile" onclick="showSection('profile')" class="nav-item flex items-center gap-3 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span class="material-icons">person</span>
                        Profile
                    </a>
                </nav>
            </div>
            
            <div class="absolute bottom-6 left-6 right-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div id="sidebarProfilePhoto" class="w-8 h-8 bg-primary rounded-full flex items-center justify-center overflow-hidden">
                            <span id="sidebarPhotoPlaceholder" class="material-icons text-white text-sm">person</span>
                            <img id="sidebarPhoto" class="w-full h-full object-cover hidden" alt="Profile">
                        </div>
                        <span id="userName" class="text-sm font-medium text-gray-700 dark:text-gray-300">Admin</span>
                    </div>
                    <button onclick="logout()" class="text-gray-500 hover:text-red-500">
                        <span class="material-icons">logout</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="lg:ml-64 flex-1 p-4 lg:p-8 pt-16 lg:pt-8">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <div class="mb-8">
                    <h1 class="text-2xl lg:text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Dashboard</h1>
                    <p class="text-gray-600 dark:text-gray-400">Welcome to Deny's Beauty World Admin Panel</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-4 lg:p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-400">Total Products</p>
                                <p id="totalProducts" class="text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                            <div class="w-10 h-10 lg:w-12 lg:h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="material-icons text-blue-600 text-lg lg:text-xl">inventory</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 lg:p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-400">Videos</p>
                                <p id="totalVideos" class="text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                            <div class="w-10 h-10 lg:w-12 lg:h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="material-icons text-green-600 text-lg lg:text-xl">video_library</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 lg:p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-400">Gallery Images</p>
                                <p id="totalImages" class="text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                            <div class="w-10 h-10 lg:w-12 lg:h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <span class="material-icons text-purple-600 text-lg lg:text-xl">photo_library</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 lg:p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs lg:text-sm font-medium text-gray-600 dark:text-gray-400">Bookings</p>
                                <p id="totalBookings" class="text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100">0</p>
                            </div>
                            <div class="w-10 h-10 lg:w-12 lg:h-12 bg-gold/20 rounded-lg flex items-center justify-center">
                                <span class="material-icons text-gold text-lg lg:text-xl">event</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="openProductModal()" class="flex items-center gap-2 p-3 bg-primary text-white rounded-lg hover:bg-primary-light">
                            <span class="material-icons">add</span>
                            Add Product
                        </button>
                        <button onclick="openVideoModal()" class="flex items-center gap-2 p-3 bg-red-500 text-white rounded-lg hover:bg-red-600">
                            <span class="material-icons">video_call</span>
                            Upload Video
                        </button>
                        <button onclick="openGalleryModal()" class="flex items-center gap-2 p-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                            <span class="material-icons">add_photo_alternate</span>
                            Add Image
                        </button>
                        <button onclick="showSection('bookings')" class="flex items-center gap-2 p-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                            <span class="material-icons">event</span>
                            View Bookings
                        </button>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Products</h1>
                    <div class="flex gap-4">
                        <button onclick="openProductModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-light">
                            <span class="material-icons inline mr-2">add</span>
                            Add New Product
                        </button>
                        <button onclick="viewProductsPage()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                            <span class="material-icons inline mr-2">visibility</span>
                            View on Website
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-full">No products found</p>
                    </div>
                </div>
            </div>

            <!-- Videos Section -->
            <div id="videos-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Videos</h1>
                    <div class="flex gap-4">
                        <button onclick="openVideoModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-light">
                            <span class="material-icons inline mr-2">video_call</span>
                            Upload Video
                        </button>
                        <button onclick="viewVideosPage()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                            <span class="material-icons inline mr-2">visibility</span>
                            View on Website
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <div id="videosGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-full">No videos found</p>
                    </div>
                </div>
            </div>

            <!-- Gallery Section -->
            <div id="gallery-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Gallery</h1>
                    <div class="flex gap-4">
                        <button onclick="openGalleryModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-light">
                            <span class="material-icons inline mr-2">add_photo_alternate</span>
                            Add Images
                        </button>
                        <button onclick="viewGalleryPage()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                            <span class="material-icons inline mr-2">visibility</span>
                            View on Website
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <div id="galleryGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-full">No images found</p>
                    </div>
                </div>
            </div>

            <!-- Services Section -->
            <div id="services-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Services</h1>
                    <button onclick="openServiceModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-light">
                        <span class="material-icons inline mr-2">add</span>
                        Add Service
                    </button>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <div id="servicesList" class="space-y-4">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">No services found</p>
                    </div>
                </div>
            </div>

            <!-- Bookings Section -->
            <div id="bookings-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Bookings</h1>
                    <button onclick="deleteAllBookings()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                        <span class="material-icons inline mr-2">delete_sweep</span>
                        Delete All
                    </button>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <div id="bookingsTable" class="overflow-x-auto">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">No bookings found</p>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-display font-bold text-gray-800 dark:text-gray-200 mb-2">Profile</h1>
                    <button onclick="openProfileModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-light">
                        <span class="material-icons inline mr-2">edit</span>
                        Edit Profile
                    </button>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 max-w-2xl">
                    <div class="flex items-center gap-6 mb-6">
                        <div id="profilePhotoContainer" class="w-20 h-20 bg-primary rounded-full flex items-center justify-center overflow-hidden">
                            <span id="profilePhotoPlaceholder" class="material-icons text-white text-3xl">person</span>
                            <img id="profilePhoto" class="w-full h-full object-cover hidden" alt="Profile">
                        </div>
                        <div>
                            <h3 id="displayName" class="text-xl font-semibold text-gray-800 dark:text-gray-200">Admin</h3>
                            <p id="displayEmail" class="text-gray-600 dark:text-gray-400">Loading...</p>
                            <p id="loginMethod" class="text-sm text-gray-500">Google Account</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let products = JSON.parse(localStorage.getItem('products') || '[]');
        let videos = JSON.parse(localStorage.getItem('videos') || '[]');
        let gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
        let services = JSON.parse(localStorage.getItem('services') || '[]');
        let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-white');
                item.classList.add('text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
            });
            
            event.target.closest('.nav-item').classList.add('bg-primary', 'text-white');
            event.target.closest('.nav-item').classList.remove('text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
            
            if (sectionName === 'products') loadProducts();
            if (sectionName === 'videos') loadVideos();
            if (sectionName === 'gallery') loadGallery();
            if (sectionName === 'services') loadServices();
            if (sectionName === 'bookings') loadBookings();
        }

        function updateStats() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalVideos').textContent = videos.length;
            document.getElementById('totalImages').textContent = gallery.length;
            document.getElementById('totalBookings').textContent = bookings.length;
        }

        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            if (products.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-full">No products found</p>';
            } else {
                grid.innerHTML = products.map(product => `
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                        <img src="${product.image || '/placeholder.jpg'}" alt="${product.name}" class="w-full h-32 object-cover rounded mb-3">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200">${product.name}</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${product.description || ''}</p>
                        <p class="text-lg font-bold text-primary">₦${product.price}</p>
                        <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded mt-2">${product.category || 'Product'}</span>
                        <div class="flex gap-2 mt-3">
                            <button onclick="deleteProduct(${product.id})" class="flex-1 bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadVideos() {
            const grid = document.getElementById('videosGrid');
            if (videos.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-full">No videos found</p>';
            } else {
                grid.innerHTML = videos.map(video => `
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                        <div class="aspect-video bg-gray-200 rounded mb-3 flex items-center justify-center cursor-pointer relative" onclick="playVideo('${video.videoUrl}', '${video.title}')">
                            ${video.videoUrl ? `
                                <video class="w-full h-full object-cover rounded" muted>
                                    <source src="${video.videoUrl}" type="video/mp4">
                                </video>
                                <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center hover:bg-opacity-50 transition-all">
                                    <span class="material-icons text-white text-4xl">play_circle_filled</span>
                                </div>
                            ` : `
                                <span class="material-icons text-gray-500 text-4xl">video_library</span>
                            `}
                        </div>
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">${video.title}</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">${video.description || 'No description'}</p>
                        <button onclick="deleteVideo(${video.id})" class="w-full bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                    </div>
                `).join('');
            }
        }

        function loadGallery() {
            const grid = document.getElementById('galleryGrid');
            if (gallery.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-full">No images found</p>';
            } else {
                grid.innerHTML = gallery.map(image => `
                    <div class="bg-white dark:bg-gray-700 rounded-lg shadow overflow-hidden">
                        <div class="aspect-square overflow-hidden cursor-pointer" onclick="viewImage('${image.imageUrl}', '${image.title}')">
                            <img src="${image.imageUrl}" alt="${image.title}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                        </div>
                        <div class="p-3">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 text-sm mb-1">${image.title}</h4>
                            <span class="inline-block px-2 py-1 bg-primary/10 text-primary text-xs rounded">${image.category}</span>
                            <button onclick="deleteGalleryImage(${image.id})" class="w-full bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 mt-2">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadServices() {
            const list = document.getElementById('servicesList');
            if (services.length === 0) {
                list.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No services found</p>';
            } else {
                list.innerHTML = services.map(service => `
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">${service.name}</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${service.description || 'No description'}</p>
                            <span class="font-bold text-primary">₦${service.price}</span>
                        </div>
                        <button onclick="deleteService(${service.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                    </div>
                `).join('');
            }
        }

        function loadBookings() {
            const table = document.getElementById('bookingsTable');
            if (bookings.length === 0) {
                table.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No bookings found</p>';
            } else {
                table.innerHTML = `
                    <table class="w-full">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3 px-4">Customer</th>
                                <th class="text-left py-3 px-4">Phone</th>
                                <th class="text-left py-3 px-4">Service</th>
                                <th class="text-left py-3 px-4">Date</th>
                                <th class="text-left py-3 px-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${bookings.map(booking => `
                                <tr class="border-b">
                                    <td class="py-3 px-4">${booking.customerName}</td>
                                    <td class="py-3 px-4">${booking.customerPhone}</td>
                                    <td class="py-3 px-4">${booking.serviceName}</td>
                                    <td class="py-3 px-4">${booking.bookingDate}</td>
                                    <td class="py-3 px-4">
                                        <button onclick="deleteBooking(${booking.id})" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }
        // Modal functions
        function openProductModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full">
                    <h3 class="text-lg font-semibold mb-4">Add New Product/Wig</h3>
                    <form id="productForm">
                        <div class="space-y-4">
                            <input type="text" id="productName" placeholder="Product/Wig Name" required class="w-full p-3 border rounded-lg">
                            <textarea id="productDescription" placeholder="Description" class="w-full p-3 border rounded-lg h-20"></textarea>
                            <input type="number" id="productPrice" placeholder="Price (₦)" required class="w-full p-3 border rounded-lg">
                            <select id="productCategory" class="w-full p-3 border rounded-lg">
                                <option value="wig">Wig</option>
                                <option value="hair-care">Hair Care Product</option>
                                <option value="accessories">Accessories</option>
                            </select>
                            <div>
                                <label class="block text-sm font-medium mb-2">Product Image</label>
                                <input type="file" id="productImage" accept="image/*" class="w-full p-3 border rounded-lg">
                                <div id="productImagePreview" class="mt-2 hidden">
                                    <img id="productPreviewImg" class="w-full h-32 object-cover rounded">
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg">Add Product</button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('productImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('productPreviewImg').src = e.target.result;
                        document.getElementById('productImagePreview').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('productForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const imageFile = document.getElementById('productImage').files[0];
                let imageUrl = '';
                
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageUrl = e.target.result;
                        saveProduct(imageUrl);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    saveProduct(imageUrl);
                }
                
                function saveProduct(imageUrl) {
                    const product = {
                        id: Date.now(),
                        name: document.getElementById('productName').value,
                        description: document.getElementById('productDescription').value,
                        price: document.getElementById('productPrice').value,
                        category: document.getElementById('productCategory').value,
                        image: imageUrl
                    };
                    products.push(product);
                    localStorage.setItem('products', JSON.stringify(products));
                    modal.remove();
                    loadProducts();
                    updateStats();
                }
            });
        }

        function openVideoModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full">
                    <h3 class="text-lg font-semibold mb-4">Upload Video</h3>
                    <form id="videoForm">
                        <div class="space-y-4">
                            <input type="text" id="videoTitle" placeholder="Video Title" required class="w-full p-3 border rounded-lg">
                            <textarea id="videoDescription" placeholder="Description" class="w-full p-3 border rounded-lg h-20"></textarea>
                            <div>
                                <label class="block text-sm font-medium mb-2">Video File</label>
                                <input type="file" id="videoFile" accept="video/*" class="w-full p-3 border rounded-lg">
                                <p class="text-xs text-gray-500 mt-1">Supported formats: MP4, MOV, AVI</p>
                            </div>
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg">Upload Video</button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('videoForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const videoFile = document.getElementById('videoFile').files[0];
                let videoUrl = '';
                
                if (videoFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        videoUrl = e.target.result;
                        saveVideo(videoUrl);
                    };
                    reader.readAsDataURL(videoFile);
                } else {
                    saveVideo(videoUrl);
                }
                
                function saveVideo(videoUrl) {
                    const video = {
                        id: Date.now(),
                        title: document.getElementById('videoTitle').value,
                        description: document.getElementById('videoDescription').value,
                        videoUrl: videoUrl
                    };
                    videos.push(video);
                    localStorage.setItem('videos', JSON.stringify(videos));
                    modal.remove();
                    loadVideos();
                    updateStats();
                }
            });
        }

        function openGalleryModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full">
                    <h3 class="text-lg font-semibold mb-4">Add Gallery Image</h3>
                    <form id="galleryForm">
                        <div class="space-y-4">
                            <input type="text" id="galleryTitle" placeholder="Image Title" required class="w-full p-3 border rounded-lg">
                            <select id="galleryCategory" class="w-full p-3 border rounded-lg">
                                <option value="wig-installation">Wig Installation</option>
                                <option value="styling">Hair Styling</option>
                                <option value="coloring">Hair Coloring</option>
                                <option value="before-after">Before & After</option>
                            </select>
                            <div>
                                <label class="block text-sm font-medium mb-2">Gallery Image</label>
                                <input type="file" id="galleryImage" accept="image/*" required class="w-full p-3 border rounded-lg">
                                <div id="galleryImagePreview" class="mt-2 hidden">
                                    <img id="galleryPreviewImg" class="w-full h-32 object-cover rounded">
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg">Add Image</button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('galleryImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('galleryPreviewImg').src = e.target.result;
                        document.getElementById('galleryImagePreview').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('galleryForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const imageFile = document.getElementById('galleryImage').files[0];
                
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const image = {
                            id: Date.now(),
                            title: document.getElementById('galleryTitle').value,
                            category: document.getElementById('galleryCategory').value,
                            imageUrl: e.target.result
                        };
                        gallery.push(image);
                        localStorage.setItem('gallery', JSON.stringify(gallery));
                        modal.remove();
                        loadGallery();
                        updateStats();
                    };
                    reader.readAsDataURL(imageFile);
                }
            });
        }

        function openServiceModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full">
                    <h3 class="text-lg font-semibold mb-4">Add New Service</h3>
                    <form id="serviceForm">
                        <div class="space-y-4">
                            <input type="text" id="serviceName" placeholder="Service Name" required class="w-full p-3 border rounded-lg">
                            <textarea id="serviceDescription" placeholder="Description" class="w-full p-3 border rounded-lg h-20"></textarea>
                            <input type="number" id="servicePrice" placeholder="Price (₦)" required class="w-full p-3 border rounded-lg">
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg">Add Service</button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('serviceForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const service = {
                    id: Date.now(),
                    name: document.getElementById('serviceName').value,
                    description: document.getElementById('serviceDescription').value,
                    price: document.getElementById('servicePrice').value
                };
                services.push(service);
                localStorage.setItem('services', JSON.stringify(services));
                modal.remove();
                loadServices();
            });
        }

        function openProfileModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full">
                    <h3 class="text-lg font-semibold mb-4">Edit Profile</h3>
                    <form id="profileForm">
                        <div class="space-y-4">
                            <div class="text-center">
                                <div class="relative inline-block">
                                    <div id="modalPhotoContainer" class="w-20 h-20 bg-primary rounded-full flex items-center justify-center overflow-hidden mx-auto">
                                        <span id="modalPhotoPlaceholder" class="material-icons text-white text-3xl">person</span>
                                        <img id="modalProfilePhoto" class="w-full h-full object-cover hidden" alt="Profile">
                                    </div>
                                    <label for="profilePhotoInput" class="absolute -bottom-1 -right-1 bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer hover:bg-blue-600">
                                        <span class="material-icons text-sm">camera_alt</span>
                                    </label>
                                </div>
                                <input type="file" id="profilePhotoInput" accept="image/*" class="hidden">
                            </div>
                            
                            <input type="text" id="profileNameInput" placeholder="Full Name" required class="w-full p-3 border rounded-lg">
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg">Save</button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            const userData = JSON.parse(sessionStorage.getItem('adminData') || '{}');
            const profileData = JSON.parse(localStorage.getItem('profileData') || '{}');
            
            document.getElementById('profileNameInput').value = profileData.name || userData.fullName || '';
            
            if (profileData.photo) {
                document.getElementById('modalProfilePhoto').src = profileData.photo;
                document.getElementById('modalProfilePhoto').classList.remove('hidden');
                document.getElementById('modalPhotoPlaceholder').classList.add('hidden');
            }
            
            document.getElementById('profilePhotoInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('modalProfilePhoto').src = e.target.result;
                        document.getElementById('modalProfilePhoto').classList.remove('hidden');
                        document.getElementById('modalPhotoPlaceholder').classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('profileForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const photoFile = document.getElementById('profilePhotoInput').files[0];
                const name = document.getElementById('profileNameInput').value;
                
                if (photoFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        saveProfile(name, e.target.result);
                    };
                    reader.readAsDataURL(photoFile);
                } else {
                    saveProfile(name, profileData.photo || '');
                }
                
                function saveProfile(name, photo) {
                    const newProfileData = { name, photo };
                    localStorage.setItem('profileData', JSON.stringify(newProfileData));
                    
                    const userData = JSON.parse(sessionStorage.getItem('adminData') || '{}');
                    userData.fullName = name;
                    sessionStorage.setItem('adminData', JSON.stringify(userData));
                    
                    document.getElementById('displayName').textContent = name;
                    document.getElementById('userName').textContent = name;
                    
                    if (photo) {
                        document.getElementById('profilePhoto').src = photo;
                        document.getElementById('profilePhoto').classList.remove('hidden');
                        document.getElementById('profilePhotoPlaceholder').classList.add('hidden');
                        
                        document.getElementById('sidebarPhoto').src = photo;
                        document.getElementById('sidebarPhoto').classList.remove('hidden');
                        document.getElementById('sidebarPhotoPlaceholder').classList.add('hidden');
                    }
                    
                    modal.remove();
                }
            });
        }

        // Delete functions
        function deleteProduct(id) {
            if (confirm('Delete this product?')) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem('products', JSON.stringify(products));
                loadProducts();
                updateStats();
            }
        }

        function deleteVideo(id) {
            if (confirm('Delete this video?')) {
                videos = videos.filter(v => v.id !== id);
                localStorage.setItem('videos', JSON.stringify(videos));
                loadVideos();
                updateStats();
            }
        }

        function deleteGalleryImage(id) {
            if (confirm('Delete this image?')) {
                gallery = gallery.filter(g => g.id !== id);
                localStorage.setItem('gallery', JSON.stringify(gallery));
                loadGallery();
                updateStats();
            }
        }

        function deleteService(id) {
            if (confirm('Delete this service?')) {
                services = services.filter(s => s.id !== id);
                localStorage.setItem('services', JSON.stringify(services));
                loadServices();
            }
        }

        function deleteBooking(id) {
            if (confirm('Delete this booking?')) {
                bookings = bookings.filter(b => b.id !== id);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                loadBookings();
                updateStats();
            }
        }

        function deleteAllBookings() {
            if (confirm('Delete ALL bookings? This cannot be undone.')) {
                bookings = [];
                localStorage.setItem('bookings', JSON.stringify(bookings));
                loadBookings();
                updateStats();
            }
        }

        // View functions
        function playVideo(videoUrl, title) {
            if (!videoUrl) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-screen overflow-hidden">
                    <div class="flex justify-between items-center p-4 border-b">
                        <h3 class="text-lg font-semibold">${title || 'Video Player'}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="aspect-video">
                        <video controls class="w-full h-full" autoplay>
                            <source src="${videoUrl}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function viewImage(imageUrl, title) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-screen overflow-hidden">
                    <div class="flex justify-between items-center p-4 border-b">
                        <h3 class="text-lg font-semibold">${title || 'Image Viewer'}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="p-4">
                        <img src="${imageUrl}" alt="${title}" class="w-full h-auto max-h-96 object-contain mx-auto">
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // View on website functions
        function viewProductsPage() {
            window.open('../products.html', '_blank');
        }

        function viewVideosPage() {
            window.open('../videos.html', '_blank');
        }

        function viewGalleryPage() {
            window.open('../gallery.html', '_blank');
        }

        function logout() {
            try {
                security.clearSession();
            } catch (error) {
                console.error('Secure logout error:', error);
                // Fallback to basic logout
                sessionStorage.clear();
                localStorage.removeItem('tempAuthData');
            }
            window.location.href = 'login.html';
        }

        // Mobile menu
        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        });

        // Initialize
        window.addEventListener('load', () => {
            const userData = JSON.parse(sessionStorage.getItem('adminData') || '{}');
            const profileData = JSON.parse(localStorage.getItem('profileData') || '{}');
            
            const displayName = profileData.name || userData.fullName || 'Admin';
            const displayEmail = userData.email || ADMIN_CONFIG.AUTHORIZED_EMAILS[0];
            
            document.getElementById('userName').textContent = displayName;
            document.getElementById('displayName').textContent = displayName;
            document.getElementById('displayEmail').textContent = displayEmail;
            document.getElementById('loginMethod').textContent = userData.provider === 'google' ? 'Google Account' : 'Email & Password';
            
            // Handle profile photo from Google or custom upload
            const googlePhoto = userData.picture;
            const customPhoto = profileData.photo;
            
            if (customPhoto) {
                // Use custom uploaded photo
                document.getElementById('profilePhoto').src = customPhoto;
                document.getElementById('profilePhoto').classList.remove('hidden');
                document.getElementById('profilePhotoPlaceholder').classList.add('hidden');
                
                document.getElementById('sidebarPhoto').src = customPhoto;
                document.getElementById('sidebarPhoto').classList.remove('hidden');
                document.getElementById('sidebarPhotoPlaceholder').classList.add('hidden');
            } else if (googlePhoto) {
                // Use Google profile photo
                document.getElementById('profilePhoto').src = googlePhoto;
                document.getElementById('profilePhoto').classList.remove('hidden');
                document.getElementById('profilePhotoPlaceholder').classList.add('hidden');
                
                document.getElementById('sidebarPhoto').src = googlePhoto;
                document.getElementById('sidebarPhoto').classList.remove('hidden');
                document.getElementById('sidebarPhotoPlaceholder').classList.add('hidden');
            }
            
            updateStats();
        });
    </script>
</body>
</html>
